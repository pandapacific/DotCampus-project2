#!/usr/bin/env node
import pe from"mri";function Q(e,t=process.argv.slice(2)){let n=pe(t),i={_:n._};for(let[r,{type:s,alias:a,default:l=s==="boolean"?!1:null}]of Object.entries(e)){if(i[r]=l,a){let o=a.slice(1);n[o]!==void 0&&(i[r]=J(n[o],s))}{let o=r.slice(2);n[o]!==void 0&&(i[r]=J(n[o],s))}}return i}function J(e,t){switch(t){case"string":return F(e);case"boolean":return D(e);case"number":return U(e);case"boolean | string":return D(e)??F(e);case"number | string":return U(e)??F(e);case"boolean | number":return D(e)??U(e);case"boolean | number | string":return D(e)??U(e)??F(e);default:throw new Error(`Unhandled type: ${t}`)}}function D(e){if(e===!0||e===!1)return e;if(e==="true")return!0;if(e==="false")return!1}function U(e){if(typeof e=="number")return e;{let t=Number(e);if(!Number.isNaN(t))return t}}function F(e){return`${e}`}import be from"@parcel/watcher";import{compile as Se,env as c}from"@tailwindcss/node";import{clearRequireCache as xe}from"@tailwindcss/node/require-cache";import{Scanner as $e}from"@tailwindcss/oxide";import{Features as ie,transform as Te}from"lightningcss";import{existsSync as Ce}from"node:fs";import M from"node:fs/promises";import T from"node:path";var B=class{#e=new Set([]);queueMacrotask(t){let n=setTimeout(t,0);return this.add(()=>{clearTimeout(n)})}add(t){return this.#e.add(t),()=>{this.#e.delete(t),t()}}async dispose(){for(let t of this.#e)await t();this.#e.clear()}};import he from"node:fs";import Z from"node:path";import{stripVTControlCharacters as ge}from"node:util";import h from"picocolors";import Y from"enhanced-resolve";import fe from"node:fs";import{createRequire as de}from"node:module";var me=de(import.meta.url).resolve;function H(e){if(typeof globalThis.__tw_resolve=="function"){let t=globalThis.__tw_resolve(e);if(t)return t}return me(e)}var ke=Y.ResolverFactory.createResolver({fileSystem:new Y.CachedInputFileSystem(fe,4e3),useSyncFileSystemCalls:!0,extensions:[".css"],mainFields:["style"],conditionNames:["style"]});function X(e){let t=typeof e=="number"?BigInt(e):e;return t<1000n?`${t}ns`:(t/=1000n,t<1000n?`${t}\xB5s`:(t/=1000n,t<1000n?`${t}ms`:(t/=1000n,t<60n?`${t}s`:(t/=60n,t<60n?`${t}m`:(t/=60n,t<24n?`${t}h`:(t/=24n,`${t}d`))))))}var G={indent:2};function v(){return`${h.italic(h.bold(h.blue("\u2248")))} tailwindcss ${h.blue(`v${we()}`)}`}function k(e){return`${h.dim(h.blue("`"))}${h.blue(e)}${h.dim(h.blue("`"))}`}function ee(e,t=process.cwd(),{preferAbsoluteIfShorter:n=!0}={}){let i=Z.relative(t,e);return i.startsWith("..")||(i=`.${Z.sep}${i}`),n&&i.length>e.length?e:i}function P(e,t){let n=e.split(" "),i=[],r="",s=0;for(let a of n){let l=ge(a).length;s+l+1>t&&(i.push(r),r="",s=0),r+=(s?" ":"")+a,s+=l+(s?1:0)}return s&&i.push(r),i}function R(e){let t=X(e);return e<=50*1e6?h.green(t):e<=300*1e6?h.blue(t):e<=1e3*1e6?h.yellow(t):h.red(t)}function E(e,t=0){return`${" ".repeat(t+G.indent)}${e}`}function w(e=""){process.stderr.write(`${e}
`)}function f(e=""){process.stdout.write(`${e}
`)}function we(){if(typeof globalThis.__tw_version=="string")return globalThis.__tw_version;let{version:e}=JSON.parse(he.readFileSync(H("tailwindcss/package.json"),"utf-8"));return e}import j from"node:fs/promises";import ye from"node:path";function I(){return new Promise((e,t)=>{let n="";process.stdin.on("data",i=>{n+=i}),process.stdin.on("end",()=>e(n)),process.stdin.on("error",i=>t(i))})}async function te(e,t){try{if(await j.readFile(e,"utf8")===t)return}catch{}await j.mkdir(ye.dirname(e),{recursive:!0}),await j.writeFile(e,t,"utf8")}var ne=String.raw;function A(){return{"--input":{type:"string",description:"Input file",alias:"-i"},"--output":{type:"string",description:"Output file",alias:"-o"},"--watch":{type:"boolean | string",description:"Watch for changes and rebuild as needed",alias:"-w"},"--minify":{type:"boolean",description:"Optimize and minify the output",alias:"-m"},"--optimize":{type:"boolean",description:"Optimize the output without minifying"},"--cwd":{type:"string",description:"The current working directory",default:"."}}}async function re(e){try{return await e()}catch(t){t instanceof Error&&w(t.toString()),process.exit(1)}}async function le(e){let t=T.resolve(e["--cwd"]);e["--output"]&&(e["--output"]=T.resolve(t,e["--output"])),e["--input"]&&e["--input"]!=="-"&&(e["--input"]=T.resolve(t,e["--input"]),Ce(e["--input"])||(w(v()),w(),w(`Specified input file ${k(ee(e["--input"]))} does not exist.`),process.exit(1)));let n=process.hrtime.bigint(),i=e["--input"]?e["--input"]==="-"?await I():await M.readFile(e["--input"],"utf-8"):ne`
        @import 'tailwindcss';
      `,r={css:"",optimizedCss:""};async function s(g,m){let y=g;if(m["--minify"]||m["--optimize"])if(g!==r.css){c.DEBUG&&console.time("[@tailwindcss/cli] Optimize CSS");let b=Be(g,{file:m["--input"]??"input.css",minify:m["--minify"]??!1});c.DEBUG&&console.timeEnd("[@tailwindcss/cli] Optimize CSS"),r.css=g,r.optimizedCss=b,y=b}else y=r.optimizedCss;c.DEBUG&&console.time("[@tailwindcss/cli] Write output"),m["--output"]?await te(m["--output"],y):f(y),c.DEBUG&&console.timeEnd("[@tailwindcss/cli] Write output")}let a=e["--input"]&&e["--input"]!=="-"?T.resolve(e["--input"]):null,l=a?T.dirname(a):process.cwd(),o=a?[a]:[];async function p(g){c.DEBUG&&console.time("[@tailwindcss/cli] Setup compiler");let m=await Se(g,{base:l,onDependency(C){o.push(C)}}),y=(m.root==="none"?[]:m.root===null?[{base:t,pattern:"**/*"}]:[m.root]).concat(m.globs),b=new $e({sources:y});return c.DEBUG&&console.timeEnd("[@tailwindcss/cli] Setup compiler"),[m,b]}let[u,d]=await re(()=>p(i));if(e["--watch"]){let g=await se(oe(d),async function m(y){try{if(y.length===1&&y[0]===e["--output"])return;let b=[],C="incremental",K=o;for(let x of y){if(K.includes(x)){C="full";break}b.push({file:x,extension:T.extname(x).slice(1)})}let V=process.hrtime.bigint(),z="";if(C==="full"){let x=e["--input"]?e["--input"]==="-"?await I():await M.readFile(e["--input"],"utf-8"):ne`
                  @import 'tailwindcss';
                `;xe(K),o=a?[a]:[],[u,d]=await p(x),c.DEBUG&&console.time("[@tailwindcss/cli] Scan for candidates");let W=d.scan();c.DEBUG&&console.timeEnd("[@tailwindcss/cli] Scan for candidates");let ce=await se(oe(d),m);await g(),g=ce,c.DEBUG&&console.time("[@tailwindcss/cli] Build CSS"),z=u.build(W),c.DEBUG&&console.timeEnd("[@tailwindcss/cli] Build CSS")}else if(C==="incremental"){c.DEBUG&&console.time("[@tailwindcss/cli] Scan for candidates");let x=d.scanFiles(b);if(c.DEBUG&&console.timeEnd("[@tailwindcss/cli] Scan for candidates"),x.length<=0){let W=process.hrtime.bigint();w(`Done in ${R(W-V)}`);return}c.DEBUG&&console.time("[@tailwindcss/cli] Build CSS"),z=u.build(x),c.DEBUG&&console.timeEnd("[@tailwindcss/cli] Build CSS")}await s(z,e);let ue=process.hrtime.bigint();w(`Done in ${R(ue-V)}`)}catch(b){b instanceof Error&&w(b.toString())}});e["--watch"]!=="always"&&process.stdin.on("end",()=>{g().then(()=>process.exit(0),()=>process.exit(1))}),process.stdin.resume()}c.DEBUG&&console.time("[@tailwindcss/cli] Scan for candidates");let S=d.scan();c.DEBUG&&console.timeEnd("[@tailwindcss/cli] Scan for candidates"),c.DEBUG&&console.time("[@tailwindcss/cli] Build CSS");let N=await re(()=>u.build(S));c.DEBUG&&console.timeEnd("[@tailwindcss/cli] Build CSS"),await s(N,e);let _=process.hrtime.bigint();w(v()),w(),w(`Done in ${R(_-n)}`)}function oe(e){return e.globs.flatMap(t=>t.pattern[0]==="!"?[]:t.pattern===""?[]:t.base)}async function se(e,t){e=e.sort((l,o)=>l.length-o.length);let n=[];for(let l=0;l<e.length;++l)for(let o=0;o<l;++o)e[l].startsWith(`${e[o]}/`)&&n.push(e[l]);e=e.filter(l=>!n.includes(l));let i=new B,r=new Set,s=new B;async function a(){await s.dispose(),s.queueMacrotask(()=>{t(Array.from(r)),r.clear()})}for(let l of e){let{unsubscribe:o}=await be.subscribe(l,async(p,u)=>{if(p){console.error(p);return}await Promise.all(u.map(async d=>{if(d.type==="delete")return;let S=null;try{S=await M.lstat(d.path)}catch{}!S?.isFile()&&!S?.isSymbolicLink()||r.add(d.path)})),await a()});i.add(o)}return async()=>{await i.dispose(),await s.dispose()}}function Be(e,{file:t="input.css",minify:n=!1}={}){function i(r){return Te({filename:t,code:r,minify:n,sourceMap:!1,drafts:{customMedia:!0},nonStandard:{deepSelectorCombinator:!0},include:ie.Nesting,exclude:ie.LogicalProperties,targets:{safari:16<<16|1024,ios_saf:16<<16|1024,firefox:8388608,chrome:7864320},errorRecovery:!0}).code}return i(i(Buffer.from(e))).toString()}import $ from"picocolors";function L({invalid:e,usage:t,options:n}){let i=process.stdout.columns;if(f(v()),e&&(f(),f(`${$.dim("Invalid command:")} ${e}`)),t&&t.length>0){f(),f($.dim("Usage:"));for(let[r,s]of t.entries()){let a=s.slice(0,s.indexOf("[")),l=s.slice(s.indexOf("["));l=l.replace(/\[.*?\]/g,u=>$.dim(u));let p=P(l,i-G.indent-a.length-1);p.length>1&&r!==0&&f(),f(E(`${a}${p.shift()}`));for(let u of p)f(E(u,a.length))}}if(n){let r=0;for(let{alias:o}of Object.values(n))o&&(r=Math.max(r,o.length));let s=[],a=0;for(let[o,{alias:p}]of Object.entries(n)){let u=[p&&`${p.padStart(r)}`,p?o:" ".repeat(r+2)+o].filter(Boolean).join(", ");s.push(u),a=Math.max(a,u.length)}f(),f($.dim("Options:"));let l=8;for(let{description:o,default:p=null}of Object.values(n)){let u=s.shift(),d=l+(a-u.length),S=2,N=i-u.length-d-S-G.indent,_=P(p!==null?`${o} ${$.dim(`[default:\u202F${k(`${p}`)}]`)}`:o,N);f(E(`${$.blue(u)} ${$.dim($.gray("\xB7")).repeat(d)} ${_.shift()}`));for(let g of _)f(E(`${" ".repeat(u.length+d+S)}${g}`))}}}var q={"--help":{type:"boolean",description:"Display usage information",alias:"-h"}},O=Q({...A(),...q}),ae=O._[0];ae&&(L({invalid:ae,usage:["tailwindcss [options]"],options:{...A(),...q}}),process.exit(1));(process.stdout.isTTY&&!O["--output"]||O["--help"])&&(L({usage:["tailwindcss [--input input.css] [--output output.css] [--watch] [options\u2026]"],options:{...A(),...q}}),process.exit(0));le(O);
